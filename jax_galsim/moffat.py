import galsim as _galsim
import jax
import jax.numpy as jnp
import numpy as np
from jax.tree_util import register_pytree_node_class

from jax_galsim.bessel import kv
from jax_galsim.core.draw import draw_by_kValue, draw_by_xValue
from jax_galsim.core.interpolate import akima_interp, akima_interp_coeffs
from jax_galsim.core.utils import (
    ensure_hashable,
    has_tracers,
    implements,
)
from jax_galsim.gsobject import GSObject
from jax_galsim.position import PositionD
from jax_galsim.random import UniformDeviate


@jax.jit
def _Knu(nu, x):
    """Modified Bessel 2nd kind for Untruncated Moffat"""
    return kv(nu, x)


@implements(
    _galsim.Moffat,
    lax_description="""\
The LAX version of the Moffat profile

- does not support truncation or beta < 1.1
- does not support gsparams.maxk_thresholds > 0.1
""",
)
@register_pytree_node_class
class Moffat(GSObject):
    _is_axisymmetric = True
    _is_analytic_x = True
    _is_analytic_k = True
    _has_hard_edges = False

    def __init__(
        self,
        beta,
        scale_radius=None,
        half_light_radius=None,
        fwhm=None,
        trunc=0.0,
        flux=1.0,
        gsparams=None,
    ):
        # notice that trunc==0. means no truncated Moffat.
        # let define beta_thr a threshold to trigger the truncature
        self._beta_thr = 1.1

        if has_tracers(trunc) or (
            isinstance(trunc, (np.ndarray, float, jnp.ndarray, int))
            and np.any(trunc != 0)
        ):
            raise ValueError(
                "JAX-GalSim does not support truncated Moffat profiles "
                f"(got trunc={repr(trunc)}, always pass the constant 0.0)!"
            )

        # Parse the radius options
        if half_light_radius is not None:
            if scale_radius is not None or fwhm is not None:
                raise _galsim.GalSimIncompatibleValuesError(
                    "Only one of scale_radius, half_light_radius, or fwhm may be specified",
                    half_light_radius=half_light_radius,
                    scale_radius=scale_radius,
                    fwhm=fwhm,
                )
            else:
                super().__init__(
                    beta=beta,
                    scale_radius=(
                        half_light_radius
                        / jnp.sqrt(jnp.power(0.5, 1.0 / (1.0 - beta)) - 1.0)
                    ),
                    flux=flux,
                    gsparams=gsparams,
                )
        elif fwhm is not None:
            if scale_radius is not None:
                raise _galsim.GalSimIncompatibleValuesError(
                    "Only one of scale_radius, half_light_radius, or fwhm may be specified",
                    half_light_radius=half_light_radius,
                    scale_radius=scale_radius,
                    fwhm=fwhm,
                )
            else:
                super().__init__(
                    beta=beta,
                    scale_radius=fwhm / (2.0 * jnp.sqrt(2.0 ** (1.0 / beta) - 1.0)),
                    flux=flux,
                    gsparams=gsparams,
                )
        elif scale_radius is None:
            raise _galsim.GalSimIncompatibleValuesError(
                "One of scale_radius, half_light_radius, or fwhm must be specified",
                half_light_radius=half_light_radius,
                scale_radius=scale_radius,
                fwhm=fwhm,
            )
        else:
            super().__init__(
                beta=beta,
                scale_radius=scale_radius,
                flux=flux,
                gsparams=gsparams,
            )

        if self.gsparams.maxk_threshold > 0.1:
            raise ValueError(
                "JAX-GalSim Moffat profiles do not support gsparams.maxk_threshold values greater than 0.1!"
            )

    @property
    @implements(_galsim.moffat.Moffat.beta)
    def beta(self):
        return self._params["beta"]

    @property
    @implements(_galsim.moffat.Moffat.trunc)
    def trunc(self):
        return 0.0

    @property
    @implements(_galsim.moffat.Moffat.scale_radius)
    def scale_radius(self):
        return self.params["scale_radius"]

    @property
    def _r0(self):
        return self.scale_radius

    @property
    def _inv_r0(self):
        return 1.0 / self._r0

    @property
    def _r0_sq(self):
        return self._r0 * self._r0

    @property
    def _inv_r0_sq(self):
        return self._inv_r0 * self._inv_r0

    @property
    def _maxRrD(self):
        """maxR/rd ; fluxFactor Integral of total flux in terms of 'rD' units."""
        return jnp.sqrt(
            jnp.power(self.gsparams.xvalue_accuracy, 1.0 / (1.0 - self.beta)) - 1.0
        )

    @property
    def _maxR(self):
        """maximum r"""
        return self._maxRrD * self._r0

    @property
    def _maxRrD_sq(self):
        return self._maxRrD * self._maxRrD

    @property
    def _fluxFactor(self):
        return 1.0

    @property
    @implements(_galsim.moffat.Moffat.half_light_radius)
    def half_light_radius(self):
        return self._r0 * jnp.sqrt(
            jnp.power(1.0 - 0.5 * self._fluxFactor, 1.0 / (1.0 - self.beta)) - 1.0
        )

    @property
    @implements(_galsim.moffat.Moffat.fwhm)
    def fwhm(self):
        return self._r0 * (2.0 * jnp.sqrt(2.0 ** (1.0 / self.beta) - 1.0))

    @property
    def _norm(self):
        """Normalisation f(x) (trunc=0)"""
        return self.flux * (self.beta - 1) / (jnp.pi * self._fluxFactor * self._r0**2)

    @property
    def _knorm(self):
        """Normalisation f(k) (trunc = 0, k=0)"""
        return self.flux

    @property
    def _knorm_bis(self):
        """Normalisation f(k) (trunc = 0; k=/= 0)"""
        x1 = self.flux * 4
        x2 = jnp.power(2.0, self.beta)
        x3 = jnp.exp(jax.lax.lgamma(self.beta - 1.0))
        return x1 / (x2 * x3)

    def __hash__(self):
        return hash(
            (
                "galsim.Moffat",
                ensure_hashable(self.beta),
                ensure_hashable(self.scale_radius),
                ensure_hashable(self.trunc),
                ensure_hashable(self.flux),
                self.gsparams,
            )
        )

    def __repr__(self):
        return (
            "galsim.Moffat(beta=%r, scale_radius=%r, trunc=%r, flux=%r, gsparams=%r)"
            % (
                ensure_hashable(self.beta),
                ensure_hashable(self.scale_radius),
                ensure_hashable(self.trunc),
                ensure_hashable(self.flux),
                self.gsparams,
            )
        )

    def __str__(self):
        s = "galsim.Moffat(beta=%s, scale_radius=%s" % (
            ensure_hashable(self.beta),
            ensure_hashable(self.scale_radius),
        )
        if self.trunc != 0.0:
            s += ", trunc=%s" % ensure_hashable(self.trunc)
        if self.flux != 1.0:
            s += ", flux=%s" % ensure_hashable(self.flux)
        s += ")"
        return s

    @property
    def _prefactor(self):
        return 2.0 * (self.beta - 1.0) / (self._fluxFactor)

    @jax.jit
    def _maxk_func(self, k):
        return (
            jnp.abs(self._kValue(PositionD(x=k, y=0)).real / self.flux)
            - self.gsparams.maxk_threshold
        )

    @property
    @jax.jit
    def _maxk(self):
        return _moffat_maxk(self.beta, self.gsparams.maxk_threshold, self._r0)

    @property
    def _stepk_lowbeta(self):
        # implicit trunc>0 => _maxR= trunc
        #    then flux never converges (or nearly so),
        #   => so just use truncation radius
        return jnp.pi / self._maxR

    @property
    def _stepk_highbeta(self):
        # ignore the 1 in (1+R^2), so approximately
        R = (
            jnp.power(self.gsparams.folding_threshold, 0.5 / (1.0 - self.beta))
            * self._r0
        )
        R = jnp.minimum(R, self._maxR)
        # at least R should be 5 HLR
        R5hlr = self.gsparams.stepk_minimum_hlr * self.half_light_radius
        R = jnp.maximum(R, R5hlr)
        return jnp.pi / R

    @property
    def _stepk(self):
        """The fractional flux out to radius R is (if not truncated)
        1 - (1+(R/rd)^2)^(1-beta)
        So solve (1+(R/rd)^2)^(1-beta) = folding_threshold
        """
        return jax.lax.select(
            self.beta <= self._beta_thr, self._stepk_lowbeta, self._stepk_highbeta
        )

    @property
    def _max_sb(self):
        return self._norm

    @jax.jit
    def _xValue(self, pos):
        rsq = (pos.x**2 + pos.y**2) * self._inv_r0_sq
        # trunc if r>maxR with r0 scaled version
        return jnp.where(
            rsq > self._maxRrD_sq, 0.0, self._norm * jnp.power(1.0 + rsq, -self.beta)
        )

    def _kValue_untrunc(self, k):
        """Non truncated version of _kValue"""
        return jnp.where(
            k > 0,
            self._knorm_bis * jnp.power(k, self.beta - 1.0) * _Knu(self.beta - 1.0, k),
            self._knorm,
        )

    @jax.jit
    def _kValue(self, kpos):
        """computation of the Moffat response in k-space with switch of truncated/untracated case
        kpos can be a scalar or a vector (typically, scalar for debug and 2D considering an image)
        """
        k = jnp.sqrt((kpos.x**2 + kpos.y**2) * self._r0_sq)
        out_shape = jnp.shape(k)
        k = jnp.atleast_1d(k)
        res = self._kValue_untrunc(k)
        return res.reshape(out_shape)

    def _drawReal(self, image, jac=None, offset=(0.0, 0.0), flux_scaling=1.0):
        _jac = jnp.eye(2) if jac is None else jac
        return draw_by_xValue(self, image, _jac, jnp.asarray(offset), flux_scaling)

    def _drawKImage(self, image, jac=None):
        _jac = jnp.eye(2) if jac is None else jac
        return draw_by_kValue(self, image, _jac)

    @implements(_galsim.Moffat.withFlux)
    def withFlux(self, flux):
        return Moffat(
            beta=self.beta,
            scale_radius=self.scale_radius,
            trunc=self.trunc,
            flux=flux,
            gsparams=self.gsparams,
        )

    @implements(_galsim.Moffat.shoot)
    def _shoot(self, photons, rng):
        # from the galsim C++ in SBMoffat.cpp
        ud = UniformDeviate(rng)

        # First get a point uniformly distributed on unit circle
        theta = ud.generate(photons.x) * 2.0 * jnp.pi
        rsq = ud.generate(
            photons.x
        )  # cumulative dist function P(<r) = r^2 for unit circle
        sint = jnp.sin(theta)
        cost = jnp.cos(theta)

        # Then map radius to the Moffat flux distribution
        newRsq = jnp.power(1.0 - rsq * self._fluxFactor, 1.0 / (1.0 - self.beta)) - 1.0
        r = self.scale_radius * jnp.sqrt(newRsq)
        photons.x = r * cost
        photons.y = r * sint
        photons.flux = self.flux / photons.size()


# START OF GENERATED CODE
# The code in this block is generated by the notebook dev/notebooks/moffat_maxk_interp.ipynb.

MKTS_MIN = 1e-12
MKTS_MAX = 0.1
N_MKTS = 100
LOG_MKTS = np.log(np.logspace(jnp.log10(MKTS_MIN), jnp.log10(MKTS_MAX), N_MKTS))

# RATIONAL_POLY_VALS is an array of 7-th order ration function approximations
# for maxk as a function of log(beta) at fixed maxk_threshold values. the coeffs
# are stored from highest degree to lowest. The shape of the array is
# (100, 2, 8).
# fmt: off
RATIONAL_POLY_VALS = np.array(
    [[[+1.3772407257259811e+00, +8.2308765855395478e+01, -2.7113255852810147e+02, +2.8334246555296641e+03,
       +1.9765894617972574e+03, -3.0250584335304524e-02, +5.2517275092954705e+01, +3.1088883127707301e+00],
      [-6.6159277500114799e-01, +2.3300377617130614e+01, -1.2112785124653568e+02, +8.2257031521055592e+02,
       +6.1224358735540159e+02, +9.9091301692586009e-02, +1.6041932331486805e+01, +1.0000000000000000e+00]],

     [[+2.9301469618244234e+00, +1.9578029891852051e+02, -6.2803645654830518e+02, +6.6256004664146676e+03,
       +5.4991268969242346e+03, -1.7182829186219774e+01, +4.5945943580134934e+00, +3.1150415531210349e+00],
      [-1.6017455969648438e+00, +5.5117319843179246e+01, -2.8338460269113045e+02, +1.9144719224876337e+03,
       +1.7031742463637518e+03, -5.2313256402460717e-01, +9.2160303794572862e-01, +1.0000000000000000e+00]],

     [[+5.5515781801146247e-01, +1.9111578358109885e+01, -6.8289246737269181e+01, +7.1756919097734351e+02,
       +3.0691070244741859e+01, +7.7777013770723391e+00, +7.7305011783660632e+01, +3.0772866381764081e+00],
      [-1.4126052617343826e-01, +5.7009376791753237e+00, -3.0705223188721376e+01, +2.1665669821866550e+02,
       +1.2541145408503814e+01, -2.3694833593932093e-02, +2.4014110086424388e+01, +1.0000000000000000e+00]],

     [[+5.6648036049731254e-01, +1.8735400700010306e+01, -6.6808851392754946e+01, +7.0650533212809194e+02,
       +3.8597519308717732e+00, -2.7686964499813147e+00, +7.6362900815417532e+01, +3.0659243493565951e+00],
      [-1.3788319118904957e-01, +5.6227922730288276e+00, -3.0261423460079520e+01, +2.1432400817635738e+02,
       +4.5376453945801742e+00, -3.3312365402032493e+00, +2.3789004930500159e+01, +1.0000000000000000e+00]],

     [[+7.3820077582555321e-02, +1.0634049793571962e+00, -2.1915748469539071e+00, +4.6480298760875733e+01,
       +2.4854521707091293e-01, +3.0138265803332843e+02, +1.0266797395983284e+02, +3.0467023082499676e+00],
      [-6.4184311077192732e-03, +3.6097499235014274e-01, -1.5966225817838011e+00, +1.4133790508104640e+01,
       -4.7969614026590559e+00, +9.0862882590663517e+01, +3.2342348924326501e+01, +1.0000000000000000e+00]],

     [[+4.1324026290886232e-02, +6.1409936373119706e+01, -1.3726161558084246e+02, +1.7624045813363048e+03,
       +4.3297772047696908e+03, +1.8187591429092424e+03, +1.8565099480093770e+02, +3.0144241858372149e+00],
      [-5.6546013652464300e-01, +1.6172320608221096e+01, -7.1072658268028476e+01, +4.6798779487861941e+02,
       +1.3093212568220231e+03, +5.6830727458793183e+02, +5.9394727569222404e+01, +1.0000000000000000e+00]],

     [[+6.5526374054127506e-02, +7.5539500528933945e-01, -5.6255552835026512e-01, +3.3235625156928378e+01,
       +1.5921850887683203e+01, +3.1724909731646500e+02, +1.0351893335425865e+02, +3.0222446605665985e+00],
      [-4.1152293531842429e-03, +2.6502098082634257e-01, -9.6006198201813864e-01, +9.9329581357929300e+00,
       -4.3668277046931092e-01, +9.6345339732717520e+01, +3.2840127881539715e+01, +1.0000000000000000e+00]],

     [[+3.1964146143736358e+00, +1.9757607132228543e+02, -6.1030727722944152e+02, +6.6787864381439986e+03,
       +5.5084562839876135e+03, -1.7134287147435135e+01, +4.2970961437807871e+00, +3.0462392273209788e+00],
      [-1.6595750178961119e+00, +5.6757587758490466e+01, -2.8856007961600994e+02, +1.9579941097706126e+03,
       +1.7390813723446283e+03, -9.4653712778318563e-02, +8.0835389922003476e-01, +1.0000000000000000e+00]],

     [[+6.6985606061443562e-02, +7.1404606006578031e-01, -3.2030606157156527e-01, +3.1644359610857013e+01,
       +1.6817010130547654e+01, +3.1786718040812241e+02, +1.0312970674225302e+02, +2.9975573825318289e+00],
      [-3.7509692460298023e-03, +2.5601095011073671e-01, -8.8591875454299451e-01, +9.5026621584168325e+00,
       -2.9258885432622367e-01, +9.7108663710101666e+01, +3.2944471842360947e+01, +1.0000000000000000e+00]],

     [[+1.0142825798290778e-01, +1.8872552560917548e+00, -5.0482974626471675e+00, +7.7006554824394016e+01,
       +1.5445917079119459e-01, +2.8361135839050081e+02, +9.9985530311744924e+01, +2.9859060524525902e+00],
      [-1.3038718221724713e-02, +6.2388818356125253e-01, -2.9985337853598817e+00, +2.3805688386481275e+01,
       -4.6694139693611891e+00, +8.6602859315710802e+01, +3.2030918592598283e+01, +1.0000000000000000e+00]],

     [[+3.3303799694985625e+00, +1.9205034970998705e+02, -5.7963879967490641e+02, +6.4988129867497355e+03,
       +5.2838181214688429e+03, -2.3208671429228374e+01, +6.7355676708696990e+00, +3.0088907217999754e+00],
      [-1.6278869787878090e+00, +5.5801762662115124e+01, -2.8159765265317645e+02, +1.9208781541722940e+03,
       +1.6856547999932548e+03, -2.1369113299947400e+00, +1.5924416678578464e+00, +1.0000000000000000e+00]],

     [[+2.5191623228057978e+00, +1.4116333038354628e+02, -4.2599144437897945e+02, +4.7920193006163909e+03,
       +3.7564555258755904e+03, -1.0178280802429168e+01, +2.6838219269146691e+01, +2.9881728484077721e+00],
      [-1.2014774722443646e+00, +4.1256967071620636e+01, -2.0844454497063242e+02, +1.4223982658141811e+03,
       +1.2034117688223378e+03, -2.4808777586263411e-01, +8.1913205735205619e+00, +1.0000000000000000e+00]],

     [[+3.6876743456102443e+00, +2.0090724130271633e+02, -5.9528899626769191e+02, +6.8037407589645418e+03,
       +5.4801186471952251e+03, -2.5898966850720321e+01, +5.0014625029817870e+00, +2.9845026512896959e+00],
      [-1.7107082807277016e+00, +5.8848080559341348e+01, -2.9508390550499064e+02, +2.0224038567167611e+03,
       +1.7607736668168272e+03, -2.6199404943183451e+00, +1.0161730126938633e+00, +1.0000000000000000e+00]],

     [[+1.9937337533743131e+00, +9.8842729573515356e+01, -2.9491117846699484e+02, +3.3833850407612290e+03,
       +2.4160862236485664e+03, -2.8522717754384717e+00, +4.5153928906438701e+01, +2.9545834597577745e+00],
      [-8.3771334827099997e-01, +2.9263468420854807e+01, -1.4728325700087333e+02, +1.0139221662270133e+03,
       +7.8104134469430335e+02, -9.2549573398508606e-04, +1.4298497287602352e+01, +1.0000000000000000e+00]],

     [[+3.7131468195225006e+00, +1.9907948307350568e+02, -5.8136690845739804e+02, +6.7362506209673184e+03,
       +5.4556338927503939e+03, -1.8763333675712072e+01, +5.0355779655898729e+00, +2.9591590003645116e+00],
      [-1.7150921373345018e+00, +5.8745237358673627e+01, -2.9348480866859558e+02, +2.0122286252633462e+03,
       +1.7652784435874369e+03, -1.6223235102810543e-01, +1.0240886775467322e+00, +1.0000000000000000e+00]],

     [[+2.4074839000315318e-02, +8.9695097262823467e+00, -6.1016068136295658e+00, +2.2798733815914113e+02,
       +9.8778261879129866e+02, +8.2189268976753829e+02, +1.3798190117566446e+02, +2.8936050702477329e+00],
      [-8.4538676627244499e-02, +2.2991886295173489e+00, -7.0063801689702867e+00, +5.4041562983868758e+01,
       +2.9845421849366403e+02, +2.6245703686309292e+02, +4.5556788759216666e+01, +1.0000000000000000e+00]],

     [[+2.2930023093981973e+00, +1.0900280272750621e+02, -3.1580146443329977e+02, +3.7233096688690080e+03,
       +2.7129551111908363e+03, +1.3590874557247792e-02, +4.1294390423510919e+01, +2.9164713878369231e+00],
      [-9.3666661416330710e-01, +3.2630430562635908e+01, -1.6270132981696489e+02, +1.1239791325303499e+03,
       +8.8629446336495243e+02, +1.4811523487449931e+00, +1.3160539697879418e+01, +1.0000000000000000e+00]],

     [[+1.7897979336373764e-02, +9.0292119929553287e+00, -4.0386070033423387e+00, +2.2414342693993760e+02,
       +1.0530621568425890e+03, +8.6657427596231537e+02, +1.4092931995624949e+02, +2.8642431697051727e+00],
      [-8.5875165691929031e-02, +2.2943860085527636e+00, -6.4831619430117282e+00, +5.1653714954214223e+01,
       +3.2005189064015406e+02, +2.7888607598762133e+02, +4.6934136083303386e+01, +1.0000000000000000e+00]],

     [[+2.9278297374117987e+00, +1.3688870168308139e+02, -3.8700096238620387e+02, +4.6609322724533704e+03,
       +3.5236423175815471e+03, -9.2622599874645850e+00, +3.0215247463215093e+01, +2.8941921792205783e+00],
      [-1.1885159478049983e+00, +4.1230201915566781e+01, -2.0397390416152956e+02, +1.4124771155319133e+03,
       +1.1591137056933651e+03, -6.7582412343263232e-02, +9.5127033861025154e+00, +1.0000000000000000e+00]],

     [[+2.0577325532871225e+00, +8.5121061371525414e+01, -2.4016620338353172e+02, +2.9298847665999183e+03,
       +1.9407906301215467e+03, -6.1616823715743529e-01, +5.1023413748746592e+01, +2.8702419285251874e+00],
      [-7.3019188524063683e-01, +2.5949869377944303e+01, -1.2823097658694599e+02, +8.9595731934795594e+02,
       +6.4298716181235363e+02, -1.8331899035089090e-02, +1.6604459604409012e+01, +1.0000000000000000e+00]],

     [[+1.0427456562612707e-01, +1.2334161958951155e+00, -2.1890212252574126e+00, +5.2927651697291552e+01,
       -1.7340374800786960e+00, +2.8701102178480284e+02, +9.7509804461600567e+01, +2.8366718149829446e+00],
      [-7.7829680531729690e-03, +4.6020027156173177e-01, -1.9698707314768475e+00, +1.7138157385306958e+01,
       -6.2944816086475202e+00, +9.0837071833635960e+01, +3.2597564161405032e+01, +1.0000000000000000e+00]],

     [[+3.8358692529128215e+00, +1.7042865778228176e+02, -4.6500243882178347e+02, +5.7919177973973183e+03,
       +4.4766610564996772e+03, -1.6078808091916461e+01, +1.7874868114332433e+01, +2.8579533098824892e+00],
      [-1.4990957510488554e+00, +5.1944490757094940e+01, -2.5413163033730217e+02, +1.7684708041016363e+03,
       +1.4894535150155662e+03, -4.3491028733092624e-01, +5.3874077828700599e+00, +1.0000000000000000e+00]],

     [[+1.1702387523891811e-01, +1.5663381776823577e+00, -2.5192437763117850e+00, +6.2877959064434371e+01,
       +2.0654079870945367e+01, +2.9978850745381669e+02, +9.8195995436251408e+01, +2.8064643716814168e+00],
      [-1.0585932100047372e-02, +5.6408885483959237e-01, -2.3353557201763513e+00, +2.0067908599542196e+01,
       +5.7280997639348008e-01, +9.5707000539245726e+01, +3.3120066415092452e+01, +1.0000000000000000e+00]],

     [[+4.8174678498563788e+00, +2.0766744415217715e+02, -5.5134276001298372e+02, +7.0453217928524728e+03,
       +5.5705863923165325e+03, -2.1608201542728786e+01, +3.5187345642479162e+00, +2.8364477434526587e+00],
      [-1.8427376100548130e+00, +6.3762955548544276e+01, -3.0935754132817976e+02, +2.1612421043812169e+03,
       +1.8677182947314998e+03, -4.3592817060510462e-04, +4.5822084649192002e-01, +1.0000000000000000e+00]],

     [[+7.0341660926199381e-02, +8.1892610352026782e+00, -2.4448147260443371e+00, +2.1311505741077431e+02,
       +9.0604564739561033e+02, +7.8267651755434099e+02, +1.3293705355597643e+02, +2.7615343521153686e+00],
      [-7.7454363223977585e-02, +2.1647413742043189e+00, -6.0191085628140204e+00, +5.0951329344823797e+01,
       +2.8048169098413013e+02, +2.5835051005139297e+02, +4.5615338551587975e+01, +1.0000000000000000e+00]],

     [[+4.7722875241467486e+00, +1.9037033849129298e+02, -4.9264836420988780e+02, +6.4751975413333057e+03,
       +4.9785621010131790e+03, -2.1635341028724213e+01, +1.1622666476632324e+01, +2.8023847418177330e+00],
      [-1.6928451112151863e+00, +5.9131943780393307e+01, -2.8452687464860651e+02, +2.0015885972494739e+03,
       +1.6845718430190905e+03, -1.0111987166710315e+00, +3.2656573852325557e+00, +1.0000000000000000e+00]],

     [[+8.2646577470131599e-01, +1.8564683492035297e+01, -5.3207514529295494e+01, +6.8937253174073328e+02,
       -8.2717207275815596e-01, +1.0363759188929388e+01, +7.2801761245612553e+01, +2.7544516801690344e+00],
      [-1.4780112588091993e-01, +6.2255082445402055e+00, -3.0926924740244619e+01, +2.2552842296557978e+02,
       +4.3712571282931290e+00, -3.4180821560805281e-03, +2.4733612310345080e+01, +1.0000000000000000e+00]],

     [[+5.4213469551705407e+00, +2.1107010496630815e+02, -5.3122193819633742e+02, +7.1684740088378157e+03,
       +5.6429264210663105e+03, +3.6375401573734267e-01, +4.4607763722972384e+00, +2.7763104179578502e+00],
      [-1.8982496456365061e+00, +6.6099809543305582e+01, -3.1564492548486942e+02, +2.2266439277782783e+03,
       +1.9244959278333351e+03, +8.0607255591200317e+00, +7.6346519674893099e-01, +1.0000000000000000e+00]],

     [[+1.2176344007285238e-01, +9.6786093988860831e+00, -4.0505269491017026e+00, +2.6281843718844993e+02,
       +9.7522141795264770e+02, +7.9847896678695110e+02, +1.3236659802355450e+02, +2.6962397363546859e+00],
      [-9.1373180034621262e-02, +2.6424112308896639e+00, -7.8057991603654404e+00, +6.5795592601539383e+01,
       +3.0707451703772631e+02, +2.6817707951766067e+02, +4.6316671901715353e+01, +1.0000000000000000e+00]],

     [[+1.0857629593711746e-01, +7.6346944458890871e+00, +1.5438564007933127e-03, +2.0125562261384650e+02,
       +8.4951214743831338e+02, +7.5868003331201112e+02, +1.3004550796494428e+02, +2.6800151691316914e+00],
      [-7.1294812013557557e-02, +2.0603280670834745e+00, -5.2534130981329419e+00, +4.8318593989173436e+01,
       +2.6657515575431785e+02, +2.5556719414311326e+02, +4.5713988415404238e+01, +1.0000000000000000e+00]],

     [[+1.3049913165668545e-01, +9.2700918307116726e+00, -1.6535599885742924e+00, +2.4897793082801837e+02,
       +9.7534201204695785e+02, +8.1010297707287805e+02, +1.3296165025529376e+02, +2.6614183154805660e+00],
      [-8.7186499504565515e-02, +2.5275642987024076e+00, -6.9159422809372311e+00, +6.1314281765736624e+01,
       +3.0875731109480125e+02, +2.7449097670907497e+02, +4.7013730359590397e+01, +1.0000000000000000e+00]],

     [[+1.3047543164976355e-01, +1.1091592733709839e+00, -1.0415624450347054e+00, +4.8175992573934295e+01,
       -1.5615068221091025e-01, +2.8610684146829647e+02, +9.4461647335244095e+01, +2.6619831585449245e+00],
      [-6.3860793358455669e-03, +4.6742020118149741e-01, -1.7898810453410994e+00, +1.6471279373648144e+01,
       -6.9297207611300440e+00, +9.4369338678794890e+01, +3.3233394534513629e+01, +1.0000000000000000e+00]],

     [[+1.6145322673415993e-01, +7.9480093690826399e+00, -1.7016589214496880e+00, +2.2152381056132302e+02,
       +7.7624987733084993e+02, +6.9981964963923861e+02, +1.2441002020156813e+02, +2.6297863023237236e+00],
      [-7.3409042852778841e-02, +2.2436164555216673e+00, -6.3475830298184368e+00, +5.6743845247436148e+01,
       +2.4617868876287747e+02, +2.3864065583426742e+02, +4.4388106958731996e+01, +1.0000000000000000e+00]],

     [[+1.0366078175218865e+00, +1.9573856083179951e+01, -4.9898539046599730e+01, +7.2382893330042884e+02,
       -7.3914018056835440e+00, +2.6618447651728223e+00, +7.0726448354046241e+01, +2.6375647442499703e+00],
      [-1.5730832385868726e-01, +6.8743355755865743e+00, -3.2800642560573323e+01, +2.4378680861065283e+02,
       +3.3312317906842766e+00, -3.0607320114525201e+00, +2.4834175303388314e+01, +1.0000000000000000e+00]],

     [[+1.6045146088238005e-01, +1.5842973740347759e+00, -1.4681130148857930e+00, +6.3442009054189484e+01,
       +2.1386745253409728e+01, +2.9575958160923028e+02, +9.4472139884940205e+01, +2.6081367278804164e+00],
      [-1.0231014959249409e-02, +6.3598076849150553e-01, -2.3902416726379383e+00, +2.1419733749615965e+01,
       -1.0749750545314342e-01, +9.8940982367021860e+01, +3.3778510141512491e+01, +1.0000000000000000e+00]],

     [[+1.0585304211410789e+00, +1.9426016927334494e+01, -4.7797727590452283e+01, +7.1620898221283710e+02,
       +7.7914881124765589e+00, +1.1458228524441164e+01, +7.0614438000713648e+01, +2.6014624360962726e+00],
      [-1.5824404910581605e-01, +6.9077813846608995e+00, -3.2634494419354866e+01, +2.4292611037892212e+02,
       +8.5099392311198301e+00, -7.8363715016818394e-02, +2.5062081965492144e+01, +1.0000000000000000e+00]],

     [[+1.5618251773859895e-01, +1.3518601534647314e+00, -7.5045218144102466e-01, +5.5052910433020244e+01,
       +1.9735859448405549e+01, +2.9505993923361899e+02, +9.3647530627979819e+01, +2.5711915224834945e+00],
      [-8.2483543972410606e-03, +5.6724581588413980e-01, -2.0253213700242059e+00, +1.8828742935842360e+01,
       -9.3277256239619566e-01, +9.9583286173422195e+01, +3.3857198686508454e+01, +1.0000000000000000e+00]],

     [[+1.5580640124845074e-01, +1.2404321935082105e+00, -2.1255211828689063e-01, +5.0576432681687649e+01,
       +2.3673298183336676e+01, +3.0026532643773271e+02, +9.3805874834632590e+01, +2.5518299059658527e+00],
      [-7.1246268150109955e-03, +5.3214417034119987e-01, -1.7843749408555740e+00, +1.7321687461617408e+01,
       +1.1806104505090298e-01, +1.0187406138569651e+02, +3.4115996331212898e+01, +1.0000000000000000e+00]],

     [[+2.6354385276526743e-01, +8.5893322980415512e+00, -1.3917032934228497e+00, +2.5060102949588710e+02,
       +7.4222542911926337e+02, +6.6568187543243448e+02, +1.1970603467568310e+02, +2.5177181719803756e+00],
      [-7.7626650355745133e-02, +2.5641241376434554e+00, -7.3749972419847989e+00, +6.7874032600647155e+01,
       +2.4090564355635365e+02, +2.3350622542076593e+02, +4.4184884566072007e+01, +1.0000000000000000e+00]],

     [[+8.5428576876692475e+00, +2.2352369471120053e+02, -4.4661575816307050e+02, +7.6520603236104407e+03,
       +5.5859866096847445e+03, -2.9942437566074535e+01, +5.1922929794808672e+00, +2.5708703325237403e+00],
      [-2.0535754121840402e+00, +7.5432515439120607e+01, -3.3731315086889344e+02, +2.4886266574064311e+03,
       +2.0272634522564849e+03, -5.8262247513112109e-01, +8.9483399173309597e-01, +1.0000000000000000e+00]],

     [[+1.7544256826953680e-02, -2.1854638624106246e-01, +1.5561274945047588e+01, -4.1644157426519435e+01,
       +4.2539060261561229e+02, +6.2867687024025702e+02, +1.1953694103603652e+02, +2.4760091605641801e+00],
      [+7.3827069447132288e-03, -2.9650325140535588e-01, +5.3609104763139843e+00, -2.4436148573521070e+01,
       +1.2962010642787357e+02, +2.2180776676872460e+02, +4.4665824823897431e+01, +1.0000000000000000e+00]],

     [[-5.1895322774937691e-01, -7.9851850552749526e-01, -5.7207977500848353e+00, -3.1528157288972960e+01,
       +1.4389386284350346e+02, +8.2922820969919059e+01, +5.5740943228447065e+01, +2.5033623677874419e+00],
      [-2.3433104442504325e-02, -5.9209015020860001e-01, -2.2577300473320563e-01, -1.6592417335615146e+01,
       +4.9605431363122086e+01, +2.7763992596082197e+01, +2.0389412039332846e+01, +1.0000000000000000e+00]],

     [[+3.9782252807192281e-01, +1.1587561556039120e+01, -2.0922040800908852e+00, +3.4463578916662357e+02,
       +9.2108063648957830e+02, +7.2865236726450541e+02, +1.2188810426345985e+02, +2.4325538429660805e+00],
      [-1.0508627827772685e-01, +3.5517814852653409e+00, -1.0448009519201694e+01, +9.6235624326236646e+01,
       +3.0704287882930242e+02, +2.6184588502600042e+02, +4.6217152008910759e+01, +1.0000000000000000e+00]],

     [[+4.0104863945134381e+00, +7.9825989562601649e+01, -1.4337474682794044e+02, +2.7748906252458255e+03,
       +1.5352209921030485e+03, +1.7220256925250290e+00, +5.3218706832255478e+01, +2.4546479675024644e+00],
      [-7.1144821489580001e-01, +2.8316004050574502e+01, -1.2272683134315892e+02, +9.3195196611589654e+02,
       +5.7658060490153343e+02, -5.1567407599931170e-02, +1.9502128429233014e+01, +1.0000000000000000e+00]],

     [[+1.5026240326216772e-01, +5.7904519452003900e-01, +3.6666352854326107e+00, +2.1365245744655194e+01,
       +7.4229694894278083e+01, +3.5013152794010927e+02, +9.5676920934058913e+01, +2.4044486862616297e+00],
      [+4.9455416427992871e-05, +2.9769608162213762e-01, +8.7909012025168503e-04, +6.4946099083879654e+00,
       +1.5278588795472361e+01, +1.2378705767310332e+02, +3.6431293076001815e+01, +1.0000000000000000e+00]],

     [[+1.0789814903911786e+01, +2.2220110898019377e+02, -3.6368371900379117e+02, +7.6287314337540402e+03,
       +5.2659643514953341e+03, -2.8917933390762418e+01, +1.1206847481693506e+01, +2.4458566138095197e+00],
      [-2.0285780666870266e+00, +7.8603899326106387e+01, -3.3365868768742615e+02, +2.5509758034300748e+03,
       +1.9841943446259497e+03, -7.7015073830130329e-02, +3.1682568786151943e+00, +1.0000000000000000e+00]],

     [[+1.1724434772460775e+01, +2.3441655376225083e+02, -3.6973473261843509e+02, +8.0478511339718161e+03,
       +5.5611007227876180e+03, -3.2227761026083655e+01, +7.8457608506827574e+00, +2.4272798950171470e+00],
      [-2.1445327234989935e+00, +8.3557912186960067e+01, -3.5182132289154674e+02, +2.7023354374905753e+03,
       +2.1088829087453137e+03, -1.2924106307554450e-01, +1.8316297419295910e+00, +1.0000000000000000e+00]],

     [[+2.4002440726176799e-01, +1.6716975725429066e+00, +6.1058831650733399e-02, +6.5704826010100902e+01,
       +2.5386281657854038e+01, +2.9041897635048275e+02, +8.9433561385104724e+01, +2.3394760708481810e+00],
      [-9.8636904813434925e-03, +7.7921046813648842e-01, -2.5404500701010102e+00, +2.3917313465324476e+01,
       -1.5023836640381397e-01, +1.0345844860852121e+02, +3.4700732192318341e+01, +1.0000000000000000e+00]],

     [[+6.1421424048475926e-01, +1.2444609937133249e+01, -7.0041443626761613e-01, +3.8446720089928510e+02,
       +8.3438847504748435e+02, +6.5818301464996284e+02, +1.1409096288475945e+02, +2.2973805593572267e+00],
      [-1.0907278911225765e-01, +4.1012278559775250e+00, -1.2047846013080742e+01, +1.1430491640880389e+02,
       +2.8645185542778995e+02, +2.4465597868928015e+02, +4.5118398451379072e+01, +1.0000000000000000e+00]],

     [[+7.2419468082445015e-01, +1.4408913810709356e+01, -1.2710628692315420e+00, +4.4755195501711887e+02,
       +9.2806643748107888e+02, +6.8585149036321945e+02, +1.1510826189393173e+02, +2.2714332092478955e+00],
      [-1.2678951496692539e-01, +4.7898973494533807e+00, -1.4275638109455796e+01, +1.3451033062783566e+02,
       +3.2208455593861555e+02, +2.5701045989022901e+02, +4.5912618100125179e+01, +1.0000000000000000e+00]],

     [[+2.6933851004890214e-01, +4.3720650466102740e+00, +1.0585659027779776e+01, +1.1362131573636785e+02,
       +5.6483846636617864e+02, +6.2488048591353947e+02, +1.1318318676913968e+02, +2.2462895152794333e+00],
      [-3.1836315973399788e-02, +1.2923548651065442e+00, -4.4745485769003740e-01, +2.5132467737198418e+01,
       +1.8695830103584208e+02, +2.3421610550723392e+02, +4.5465567687806242e+01, +1.0000000000000000e+00]],

     [[+2.8229325075657241e-01, +4.3998420847201700e+00, +1.1207133898123470e+01, +1.1375345914592496e+02,
       +5.7168970237154485e+02, +6.2892758182784519e+02, +1.1301141134239425e+02, +2.2198108496984865e+00],
      [-3.1351969865199412e-02, +1.3022786388783874e+00, -2.6672731542963479e-01, +2.4921762202866336e+01,
       +1.9007878301283182e+02, +2.3734600235878625e+02, +4.5784135236945588e+01, +1.0000000000000000e+00]],

     [[+2.8465027602184384e-01, +3.8568095954838224e+00, +1.0474618368573244e+01, +1.0089922245109298e+02,
       +4.9465955295904166e+02, +5.8430023127775223e+02, +1.0930869086132437e+02, +2.1955916127172879e+00],
      [-2.6083999090267596e-02, +1.1814590101774052e+00, -1.8033892111359195e-01, +2.2648660895878024e+01,
       +1.6356078379276605e+02, +2.2147641945542438e+02, +4.4609380140400951e+01, +1.0000000000000000e+00]],

     [[+4.0557084240160308e-02, -7.3614388609051602e-03, +1.6570608352664365e+01, -3.6399267123270214e+01,
       +4.5194242377159622e+02, +6.2210311557407067e+02, +1.1255995349788536e+02, +2.1646467475352820e+00],
      [+1.0477527823130404e-02, -3.2739805332778438e-01, +6.3461193633764497e+00, -2.6666273399780504e+01,
       +1.4452379107220366e+02, +2.3753204391196007e+02, +4.6408915825386693e+01, +1.0000000000000000e+00]],

     [[+3.9108219324760246e-01, +2.6288770719324392e+00, -5.1670463452316670e-02, +9.9332952996509519e+01,
       +2.4435513965693371e+01, +2.7520813156643129e+02, +8.5393095516079214e+01, +2.1605685779086001e+00],
      [-1.6747935242061775e-02, +1.2785210351969665e+00, -4.2109916667428262e+00, +3.7890582720602779e+01,
       -6.9434420634499916e-01, +1.0187350383903885e+02, +3.5025379592574268e+01, +1.0000000000000000e+00]],

     [[+2.0344133387785920e-01, +1.1471689051034846e+00, +9.8327729123641330e+00, +2.1812286516844782e+01,
       +2.7419587105592007e+02, +4.7761807173683985e+02, +1.0055713288281683e+02, +2.1173601843664023e+00],
      [-4.8491441712566395e-04, +3.6742109292400515e-01, +1.9886713694749600e+00, +6.3451984269789774e-01,
       +8.4587681867553670e+01, +1.8328729564782353e+02, +4.2020361813388611e+01, +1.0000000000000000e+00]],

     [[+4.7583341477849367e-01, +3.2351846258835755e+00, -2.0447538795522410e-01, +1.2044996888749738e+02,
       +2.5338004698214537e+01, +2.6676282583088295e+02, +8.3783573154798660e+01, +2.1037420447863346e+00],
      [-2.1411025847315246e-02, +1.5794661535892993e+00, -5.2379116345312511e+00, +4.6461577788446483e+01,
       -4.7074007783952244e-02, +9.9848214682481185e+01, +3.4979254575753004e+01, +1.0000000000000000e+00]],

     [[+4.0123199268531579e-01, +4.7362240486927423e+00, +1.3056022789650243e+01, +1.2543315883789867e+02,
       +5.4980629548039929e+02, +6.0290239986525580e+02, +1.0772769243264293e+02, +2.0492523597462795e+00],
      [-3.0021683933528991e-02, +1.5082524872515677e+00, -2.1840025279556002e-01, +2.9756858937023907e+01,
       +1.8767963358724245e+02, +2.3738589857622847e+02, +4.6113004782420525e+01, +1.0000000000000000e+00]],

     [[+2.1826553692411661e+01, +2.7022006796661714e+02, -1.6284926981766773e+02, +9.2042694838875559e+03,
       +5.7770808183089493e+03, -4.4763674988653534e+01, +8.4089004545549795e+00, +2.1285648558451773e+00],
      [-2.3641564028891597e+00, +1.0825224909262361e+02, -3.8919645184944812e+02, +3.2987687539006233e+03,
       +2.4099185216021201e+03, -1.5631450607984460e-04, +1.8443521063941193e+00, +1.0000000000000000e+00]],

     [[+6.6348096276577495e-01, +4.2953815149476968e+00, -6.0102576193808399e-01, +1.5894255395750650e+02,
       -1.2653201745722070e-01, +2.3797198849833796e+02, +8.0307528452164078e+01, +2.0133346613091767e+00],
      [-2.8999793614118821e-02, +2.1774799165132102e+00, -7.3523250034487404e+00, +6.3509330169491498e+01,
       -8.6487399948815682e+00, +9.0039130999894567e+01, +3.4466279603001105e+01, +1.0000000000000000e+00]],

     [[+8.7489746741053004e-02, +1.8290648183462690e+00, +2.1584732954266869e+01, +5.3622412629110157e+00,
       +6.9281312114858940e+02, +7.3537091832754368e+02, +1.1558585301022102e+02, +1.9406282068595540e+00],
      [-1.1801136562292653e-04, +8.4783772304317052e-04, +7.6838427851249227e+00, -2.2425774061190406e+01,
       +2.3808593244784024e+02, +2.9844561242196818e+02, +5.1348642049950634e+01, +1.0000000000000000e+00]],

     [[+3.8927164320121244e+00, +4.3362692304002415e+01, -6.8861716799828787e-01, +1.4400838471681525e+03,
       +1.2947509371947933e+03, +4.9321570524917229e+02, +8.9573425616519145e+01, +1.9367350229414939e+00],
      [-3.6544684608036743e-01, +1.7574928918484893e+01, -5.5700849976203777e+01, +5.1133451647526857e+02,
       +5.1832483532024048e+02, +2.0357907622274308e+02, +3.9735769327701455e+01, +1.0000000000000000e+00]],

     [[+5.6261592886541323e-01, +5.5411121884062240e+00, +1.5886660992248174e+01, +1.4764342404562754e+02,
       +5.7017983580844134e+02, +5.9984824296537784e+02, +1.0420032432007434e+02, +1.8812153187929239e+00],
      [-3.1715155590194465e-02, +1.8726646209203779e+00, -2.3472586833600845e-01, +3.7466907483057902e+01,
       +2.0062596000151254e+02, +2.4637596346558283e+02, +4.7151098755740819e+01, +1.0000000000000000e+00]],

     [[-2.0420496616199318e-01, -8.5708866521566240e-01, -1.2633321170944050e+00, -1.7606011301906221e+01,
       +3.2549739113207847e+00, +1.3964498200059472e+02, +6.0910103258638429e+01, +1.9091590696892402e+00],
      [-5.0663919848673890e-04, -4.3018009766252641e-01, +4.4314856341348935e-01, -7.2559108382633051e+00,
       -4.9190415810359189e+00, +5.3361036893286183e+01, +2.6930468733901094e+01, +1.0000000000000000e+00]],

     [[+2.0071339674383449e+01, +2.0296142987450352e+02, -6.8923122436107487e-01, +6.8258458909357878e+03,
       +4.4927721707200881e+03, +2.1462657079032721e+02, +3.8202445652297911e+01, +1.9013691221825708e+00],
      [-1.7401652437231361e+00, +8.6630320766068223e+01, -2.8028288725596195e+02, +2.5234670726827972e+03,
       +1.9663362900465504e+03, +1.0864786435488449e+02, +1.6273227862610806e+01, +1.0000000000000000e+00]],

     [[+5.4731992058083090e-01, +2.2144122805963069e+00, +3.9819688002749443e+00, +7.9406818279187817e+01,
       +3.4884163475769917e+01, +2.8329321652704539e+02, +8.0201780914013611e+01, +1.7967787330189322e+00],
      [-9.2877530350562558e-03, +1.3753245639197513e+00, -3.3382848622918435e+00, +3.3581371536133013e+01,
       -1.2803590695305471e-02, +1.1398472037627153e+02, +3.7004078893307195e+01, +1.0000000000000000e+00]],

     [[+7.6460312018824250e-01, +6.4925760962306187e+00, +1.8904976778841309e+01, +1.7299901158404208e+02,
       +5.8468822250304379e+02, +5.9288485613079979e+02, +1.0067050143242868e+02, +1.7253610566137889e+00],
      [-3.3850249916493116e-02, +2.3332480519420469e+00, -4.2565518694367799e-01, +4.7069096457405372e+01,
       +2.1156004516129636e+02, +2.5307789321411008e+02, +4.8002235615513058e+01, +1.0000000000000000e+00]],

     [[+4.1460292751127625e-01, +1.0353796146023397e+00, +4.5132959489509865e+00, +3.8080842863268316e+01,
       +3.9338321909419221e+01, +2.9466232960525309e+02, +7.9578288677361769e+01, +1.7144672330150652e+00],
      [+1.5180245765565261e-04, +8.4425970184155608e-01, -1.4297467254590401e+00, +1.7186991267023611e+01,
       -4.0565799282740095e-01, +1.2111944865954909e+02, +3.7752485078318216e+01, +1.0000000000000000e+00]],

     [[+1.3232322942386650e+00, +7.5401381652075949e+00, -3.1454067282579552e-02, +2.8153764856417018e+02,
       -5.3955693408751472e+01, +1.3689728662010469e+02, +6.6990782454279639e+01, +1.6911736479691768e+00],
      [-6.1993534484131793e-02, +4.3540162062511820e+00, -1.5185820898890254e+01, +1.2175544563027074e+02,
       -2.4143014887211105e+01, +5.1389208541088138e+01, +3.1671347594390181e+01, +1.0000000000000000e+00]],

     [[+9.6623390869043557e-01, +7.5896713833724343e+00, +2.3082626826361075e+01, +1.9773315927766626e+02,
       +6.3681958781702735e+02, +6.0976790211123034e+02, +9.9169071982544722e+01, +1.5894364401510070e+00],
      [-3.6149209426653457e-02, +2.7872403433876598e+00, -5.9192259690413244e-02, +5.4933457644247291e+01,
       +2.3671232591511034e+02, +2.6937648448714413e+02, +4.9547767337838309e+01, +1.0000000000000000e+00]],

     [[+4.5480094032103419e-01, +3.6583749303633719e+00, +2.1499060169186503e+01, +6.5752108246398350e+01,
       +5.8556087381873147e+02, +6.2456736021924792e+02, +9.9730322187673963e+01, +1.5379451051681854e+00],
      [-4.1424436818221664e-03, +9.0766470716622538e-01, +5.7263272646302221e+00, +2.3518644555314925e+00,
       +2.1151287357875157e+02, +2.7893935449207640e+02, +5.0727570033237974e+01, +1.0000000000000000e+00]],

     [[+1.1565320689238525e+00, +8.3759495605524599e+00, +2.5401218919668594e+01, +2.1743404135513464e+02,
       +6.3654864206887862e+02, +5.9839831060260587e+02, +9.6492357835427114e+01, +1.4913357640668277e+00],
      [-3.7841793616395426e-02, +3.2153877395059638e+00, -3.7079088044338515e-01, +6.3422041971005527e+01,
       +2.4070859128758167e+02, +2.7058597165110274e+02, +4.9859539773328017e+01, +1.0000000000000000e+00]],

     [[+4.4326840783049215e-01, +5.6734821480307718e-01, -2.0167192203399531e+00, +4.4817838983573296e+01,
       -1.6734864543578294e+02, +9.4545684284481396e+01, +5.8456201464576630e+01, +1.5219509080273192e+00],
      [-5.0691001453523673e-03, +1.0829044962243994e+00, -5.1791511868094338e+00, +3.0874179549831059e+01,
       -7.7835457306475348e+01, +3.3370688885504158e+01, +2.9086732925854189e+01, +1.0000000000000000e+00]],

     [[+1.3476224661040141e+00, +9.1076491397755177e+00, +2.8619695229054521e+01, +2.3070757985883358e+02,
       +6.5223190351582787e+02, +5.9942977694832746e+02, +9.4528704820415172e+01, +1.3819004811067108e+00],
      [-3.7390277464451921e-02, +3.5844543218660121e+00, +1.3384308631964458e-03, +6.8609924993601311e+01,
       +2.5095636855595527e+02, +2.7820819157947398e+02, +5.0738285878962422e+01, +1.0000000000000000e+00]],

     [[-1.8795318549602608e-01, +4.5411962177195964e-01, +2.1658590755843214e+01, -5.6404223016057649e+01,
       +6.5673892457119109e+02, +6.9241903746605124e+02, +1.0003972802914707e+02, +1.3074755861960090e+00],
      [+2.6699042108957623e-02, -1.2163436457631205e+00, +1.3816494834757956e+01, -5.6556455101414350e+01,
       +2.3816237165538990e+02, +3.2693910196392432e+02, +5.5198475374735835e+01, +1.0000000000000000e+00]],

     [[+1.6096465887871743e+00, +1.0344088941089611e+01, +3.3355167271901436e+01, +2.5434607172073066e+02,
       +6.9524546126152325e+02, +6.1172584145475923e+02, +9.2989901932242461e+01, +1.2591931344401355e+00],
      [-3.8725234349325371e-02, +4.1368879706304087e+00, +5.4252679330050813e-01, +7.6829866974530717e+01,
       +2.7351496502047485e+02, +2.9245876809536787e+02, +5.2121034413151733e+01, +1.0000000000000000e+00]],

     [[+1.7411453414051581e+00, +1.0502943490147679e+01, +3.3969969512887445e+01, +2.5654325189056624e+02,
       +6.6009328647215887e+02, +5.8892375684915453e+02, +9.0446167643949963e+01, +1.1970265671913947e+00],
      [-3.7281147212007690e-02, +4.3714916451793737e+00, +2.1344236727330632e-01, +8.0241707457295803e+01,
       +2.6131753576536727e+02, +2.8515562562340750e+02, +5.1784735230488096e+01, +1.0000000000000000e+00]],

     [[+2.0561611673403539e+00, +1.2086333582990170e+01, +3.8461327568750768e+01, +2.9319682282738466e+02,
       +7.0085734209717623e+02, +5.9825291549231906e+02, +8.9658294685790750e+01, +1.1261718125859070e+00],
      [-4.2495371131513450e-02, +5.1336967237673630e+00, -1.2223242322869646e-01, +9.4447611299147084e+01,
       +2.8259346871442352e+02, +2.9473115447373851e+02, +5.2649738732709778e+01, +1.0000000000000000e+00]],

     [[+2.1738337960100806e+00, +1.2144988265492888e+01, +3.9399906563301876e+01, +2.8880809279040443e+02,
       +6.7533858909167054e+02, +5.8315171273262092e+02, +8.7507633591911940e+01, +1.0547921929361770e+00],
      [-3.9326700053659659e-02, +5.2927080114887879e+00, +7.7350262419430132e-02, +9.4617194862346878e+01,
       +2.7398014395845780e+02, +2.9151283502777341e+02, +5.2676206163389459e+01, +1.0000000000000000e+00]],

     [[+4.3527370274637789e-01, +6.0538718447497087e-04, +5.4360119357374268e+00, +1.3659780528794181e+00,
       +8.8464792037076677e+01, +3.1765913938615012e+02, +7.0804284419626029e+01, +1.0317955556703429e+00],
      [+1.0177507949468090e-02, +6.0712934757713732e-01, +3.2203665475646183e-03, +1.9050111190178953e+00,
       +1.1796953592282092e+01, +1.5128753992479236e+02, +4.2362731324275558e+01, +1.0000000000000000e+00]],

     [[-3.7946323814634719e-01, +1.7715812791681831e+00, +2.4021074533592817e+01, -4.1358018297497253e+01,
       +7.6925510962161684e+02, +7.1867492990653534e+02, +9.2750794882251384e+01, +8.6041222516851468e-01],
      [+2.8968106572865741e-02, -1.6471826910449698e+00, +1.8036209235486922e+01, -6.5235340523156339e+01,
       +2.9511607044491990e+02, +3.7535571769561244e+02, +6.0043340884954745e+01, +1.0000000000000000e+00]],

     [[+1.0060459114405234e+00, +7.6149600922258021e+00, +3.5577060941830240e+01, +1.1904933951373886e+02,
       +7.6788003298662693e+02, +6.7006903037789925e+02, +8.8102115277405943e+01, +7.7949153642678914e-01],
      [+4.6663799984117936e-04, +1.8896568193374099e+00, +1.1591032842324973e+01, +9.0824371159331552e+00,
       +3.0827373405853990e+02, +3.5608772135430422e+02, +5.8662040725897995e+01, +1.0000000000000000e+00]],

     [[+4.0865654236762738e+00, +2.0393698323015187e+01, +6.5273816184616621e+01, +4.4904304244807440e+02,
       +8.4059851746054346e+02, +6.1775492444372048e+02, +8.2975961564889886e+01, +6.9558669419283026e-01],
      [-5.6427494690914619e-02, +9.5459705885720094e+00, +3.3475451955326446e-02, +1.6069109562391336e+02,
       +3.6836985721873236e+02, +3.3530760108443155e+02, +5.6865433279484250e+01, +1.0000000000000000e+00]],

     [[-2.4236204707427109e-01, +3.9583048553477376e+00, +2.8587923643956522e+01, -6.5073725032787233e-01,
       +8.3819730930357309e+02, +7.2578871022973351e+02, +8.7297514174634856e+01, +5.5539308291825240e-01],
      [+2.5317137096832174e-02, -1.2652862380914245e+00, +2.0056772039720308e+01, -5.6330721520789034e+01,
       +3.3421383621281097e+02, +4.0384722215646218e+02, +6.3109384449237972e+01, +1.0000000000000000e+00]],

     [[+1.8137952663290848e+00, +1.2352691999606634e+01, +4.9623499405452918e+01, +1.9666669490751406e+02,
       +8.9798333142061165e+02, +7.0271940026732068e+02, +8.3704274283492893e+01, +4.4380143998143751e-01],
      [-5.4635384257920739e-03, +3.6561099851146195e+00, +1.4468197895047640e+01, +3.4024021579710599e+01,
       +3.8009780387484903e+02, +4.0068849006430361e+02, +6.2989147391234035e+01, +1.0000000000000000e+00]],

     [[+3.4899969970532521e+00, +6.5878537320293704e+00, +2.1008647081660225e+01, +1.4359506961072557e+02,
       +8.9674055427867416e-01, +2.7252307491658058e+02, +6.2347569760934363e+01, +4.4857017581966968e-01],
      [+1.0941522629803323e-04, +7.0629426337194401e+00, -1.0761375027431228e+01, +8.7839805569503909e+01,
       -2.7515442561229591e+01, +1.3668576639286491e+02, +4.4998536973347925e+01, +1.0000000000000000e+00]],

     [[+2.2191422043070292e+00, +1.4882569250529741e+01, +5.7242947793357608e+01, +2.1708884231484501e+02,
       +9.5892604012103288e+02, +7.1782125300807172e+02, +7.9543195613469166e+01, +1.6102450060296244e-01],
      [-2.4354735869148219e-03, +4.3934016673649481e+00, +1.8056877638777941e+01, +3.7498809524128220e+01,
       +4.1654846491708139e+02, +4.3155576935637282e+02, +6.6359416298396496e+01, +1.0000000000000000e+00]],

     [[+2.8133847508398664e+00, +1.7677974727649499e+01, +6.5069597702178257e+01, +2.5537117026990913e+02,
       +9.9433138034698447e+02, +7.1950992477411683e+02, +7.6741611247146338e+01, -2.4799406323206099e-03],
      [-5.1265354529638424e-03, +5.6529507925924101e+00, +1.9376696178459909e+01, +5.2951570999956807e+01,
       +4.4093156176354546e+02, +4.4549651071973398e+02, +6.7969773021295282e+01, +1.0000000000000000e+00]],

     [[+2.9296291492614537e+00, +1.9494435830003596e+01, +7.0538974065080083e+01, +2.6035099453580995e+02,
       +1.0633885810675213e+03, +7.4519425285037619e+02, +7.4632492696159133e+01, -1.9921223032107208e-01],
      [-1.5845259244146391e-03, +5.7913891166878511e+00, +2.3657576687508069e+01, +4.8094858145555129e+01,
       +4.7798572074383452e+02, +4.7717080548098704e+02, +7.1085204509952291e+01, +1.0000000000000000e+00]],

     [[-9.5298584036756051e-01, +1.0335536994709768e+01, +4.6681703330162811e+01, +5.4292166835872635e+01,
       +1.1754416518848561e+03, +8.2786404120372424e+02, +7.4014962734608744e+01, -4.5640759080653381e-01],
      [+3.0386489599976082e-02, -2.8073537095231078e+00, +3.8133538030662180e+01, -7.4808327072089511e+01,
       +5.1225625679179916e+02, +5.5097158848491904e+02, +7.7648658726219765e+01, +1.0000000000000000e+00]],

     [[+2.3180240858684272e+01, +8.2374317140756801e+01, +2.3716350460945932e+02, +1.2373812395111327e+03,
       +1.1758828633918636e+03, +6.1309490987857157e+02, +6.2941619214963957e+01, -5.7409874102215308e-01],
      [-1.1416782708459888e-01, +4.9184035442407286e+01, -3.4497238028593252e-01, +5.6750926813608669e+02,
       +6.5962332651781389e+02, +4.2217650867896191e+02, +6.8067416195555111e+01, +1.0000000000000000e+00]],

     [[+6.0111619743265123e+00, +3.6222894998643568e+01, +1.1484974125100499e+02, +4.0021678565887521e+02,
       +1.3333811397364841e+03, +8.2105026082489417e+02, +6.4620993007086852e+01, -1.0016701954739464e+00],
      [-2.9621941605737579e-03, +1.1979341548760486e+01, +4.0260253624287792e+01, +9.3268144152656333e+01,
       +6.4054095313239350e+02, +5.9266442872427922e+02, +8.2897686403947887e+01, +1.0000000000000000e+00]],

     [[+8.8920565839086940e+00, +4.9250536039938879e+01, +1.4631169790525087e+02, +4.9889011692168259e+02,
       +1.4665232293656129e+03, +8.5508973874447497e+02, +5.9750543604101487e+01, -1.3873378097803073e+00],
      [-7.3161572781681094e-03, +1.7835908297483435e+01, +5.0038455956954181e+01, +1.3372157251944881e+02,
       +7.2643559755168974e+02, +6.4824660233177303e+02, +8.8646241425073043e+01, +1.0000000000000000e+00]],

     [[+2.9732129656342270e+01, +6.1939140587158498e+01, +1.0232485284220567e+02, +5.4598067005363430e+02,
       +2.4612800976675068e+01, +3.2882554271999652e+02, +4.9163635369584306e+01, -1.3424725480376145e+00],
      [-2.3482472842980322e-02, +6.0134665456986113e+01, -4.6590499573734405e+01, +3.6481265157888873e+02,
       +2.1832601588301404e-01, +1.9212246496800284e+02, +6.1844623872500250e+01, +1.0000000000000000e+00]],

     [[+1.5034584568195925e+01, +7.8102038949331089e+01, +1.9777543214511900e+02, +5.6066196658173453e+02,
       +1.6740241497400125e+03, +9.2481059962351139e+02, +4.5789855887813651e+01, -2.4844757805759792e+00],
      [-3.1623286402431773e-03, +2.9949827798954281e+01, +7.9959771778487408e+01, +1.5140683735733742e+02,
       +8.5284570034542821e+02, +7.7835994419565952e+02, +1.0404456957154936e+02, +1.0000000000000000e+00]],

     [[+8.6426665856523357e+00, +7.6031062903421571e+01, +1.9664998206736399e+02, +3.7879630330639122e+02,
       +1.9525306337298821e+03, +1.0483428330537661e+03, +3.4843646192322396e+01, -3.4331398156675208e+00],
      [+3.1950064364225206e-02, +1.6273371987426799e+01, +1.2102508696736690e+02, +1.0955874365308185e+01,
       +9.6786569835326975e+02, +9.4285097247548856e+02, +1.2086189373315057e+02, +1.0000000000000000e+00]],

     [[+2.4487930878946464e+00, +8.7512434517932164e+01, +2.4183723831998248e+02, +2.6897333568611390e+02,
       +2.3518231795074180e+03, +1.2007062791187602e+03, +1.7723766440024072e+01, -4.8287449442261847e+00],
      [+7.3162459585742579e-02, +2.8389351243855097e+00, +1.8793394576460014e+02, -1.0103009758970187e+02,
       +1.1510321388551117e+03, +1.1648998166820222e+03, +1.4416745338080560e+02, +1.0000000000000000e+00]],

     [[+1.1688414330116196e+01, +1.0144349021402589e+02, +1.6900004185736304e+02, -1.2811792036916057e+00,
       +2.1126994796248855e+03, +1.1947519899795302e+03, +7.3751741916276512e-03, -6.4719724282879811e+00],
      [+6.2090921764046153e-02, +2.1444090499982039e+01, +1.7210862669779306e+02, -2.0928951756371566e+02,
       +9.3903304647264247e+02, +1.1989538847982978e+03, +1.5998761675959199e+02, +1.0000000000000000e+00]],

     [[+1.6646475603527315e+00, +1.6960167767429451e+02, +3.2805008155320621e+02, -4.6225346635233683e+02,
       +3.0042779529578120e+03, +1.6009517758562783e+03, -4.7624142304532704e+01, -1.0592424633550428e+01],
      [+1.7839465508966271e-01, -1.7488582405808746e+00, +3.9386812306906342e+02, -5.4705576869918411e+02,
       +1.2274306017658782e+03, +1.7601168868203802e+03, +2.2481716236035817e+02, +1.0000000000000000e+00]],

     [[-1.8455874948987820e+01, +2.7638602759959178e+02, +4.8696507602769066e+02, -1.9427781334218873e+03,
       +3.9351405024490878e+03, +2.2685872646182474e+03, -1.3922308487032595e+02, -1.9317439557367759e+01],
      [+4.3485673251043783e-01, -4.8909807093428938e+01, +7.7763263921335340e+02, -1.3939406189455046e+03,
       +1.1104785813500052e+03, +2.6164503600222411e+03, +3.4507048421206957e+02, +1.0000000000000000e+00]]],
    dtype=np.float64,
)
# fmt: on


@jax.jit
def _moffat_maxk(beta, maxk_threshold, r0):
    log_beta = jnp.log(beta)
    log_maxk_threshold = jnp.log(maxk_threshold)
    maxk_vals = jnp.array(
        [
            jnp.exp(
                jnp.polyval(RATIONAL_POLY_VALS[i, 0, :], log_beta)
                / jnp.polyval(RATIONAL_POLY_VALS[i, 1, :], log_beta)
            )
            for i in range(N_MKTS)
        ]
    )
    coeffs = akima_interp_coeffs(LOG_MKTS, maxk_vals)
    return akima_interp(log_maxk_threshold, LOG_MKTS, maxk_vals, coeffs) / r0


# END OF GENERATED CODE
